<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PIN-UP Home</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background: linear-gradient(135deg, #c3ec52, #0ba29d);
            color: #333;
            height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ì „ì²´ í™”ë©´ì„ ì™¼ìª½ ì¹´ë“œ + ì˜¤ë¥¸ìª½ ì§€ë„ ë ˆì´ì•„ì›ƒìœ¼ë¡œ */
        .wrapper {
            display: flex;
            align-items: flex-start;
            gap: 40px;
            width: 90%;
            max-width: 1200px;
        }

        /* ì™¼ìª½ í”„ë¡œí•„ ì¹´ë“œ */
        .container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            text-align: center;
            padding: 40px;
            width: 420px;
        }

        .logo {
            width: 150px;
            height: auto;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 26px;
            margin-bottom: 25px;
            color: #222;
        }

        .profile {
            margin: 15px auto 25px;
        }

        .profile img {
            border-radius: 50%;
            width: 90px;
            height: 90px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .info {
            font-size: 16px;
            margin-bottom: 25px;
        }

        .dashboard {
            background: #f7f7f7;
            border-radius: 12px;
            padding: 20px;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
        }

        .stat {
            font-size: 16px;
            margin: 10px 0;
        }

        .highlight {
            color: #0ba29d;
            font-weight: bold;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s;
            margin: 8px 5px 0;
        }

        .logout-btn {
            background-color: #f44336;
            color: white;
        }

        .logout-btn:hover {
            background-color: #d32f2f;
        }

        .mypage-btn {
            background-color: #4CAF50;
            color: white;
        }

        .mypage-btn:hover {
            background-color: #388E3C;
        }

        /* ì§€ë„ */
        .map-container {
            flex-grow: 1;
            height: 600px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<div class="wrapper">
    <!-- ì™¼ìª½: í™ˆ ì¹´ë“œ -->
    <div class="container">
        <img th:src="@{/images/pinup_logo.png}" alt="PINUP ë¡œê³ " class="logo">
        <h1 th:text="'í™˜ì˜í•©ë‹ˆë‹¤, ' + ${user['name']} + 'ë‹˜ ğŸ‰'"></h1>

        <div class="profile">
            <img th:src="${user['picture']}" alt="í”„ë¡œí•„ ì‚¬ì§„">
        </div>

        <div class="info">
            <p><strong>ì´ë©”ì¼:</strong> <span th:text="${user['email']}"></span></p>
        </div>

        <div class="dashboard">
            <h3>ğŸŒ ì—¬í–‰ ëŒ€ì‹œë³´ë“œ</h3>
            <p class="stat">ì •ë³µí•œ ì§€ì—­ ìˆ˜:
                <span class="highlight" th:text="${user['conqueredCount'] != null ? user['conqueredCount'] : 0}"></span></p>
            <p class="stat">ëˆ„ì  í¬ì¸íŠ¸:
                <span class="highlight" th:text="${user['totalPoints'] != null ? user['totalPoints'] : 0}"></span></p>
        </div>

        <a href="/mypage" class="btn mypage-btn">ë§ˆì´í˜ì´ì§€</a>
        <a href="/logout" class="btn logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì§€ë„ -->
    <div class="map-container">
        <div id="map"></div>
    </div>
</div>

<!-- ì§€ë„ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    // Leaflet ì§€ë„ ìƒì„±
    var map = L.map('map', {
        center: [36.5, 127.9], // ëŒ€í•œë¯¼êµ­ ì¤‘ì‹¬
        zoom: 6,
        zoomControl: true
    });

    // ìœ¤ê³½ì„  ì „ìš© íƒ€ì¼ (í‘ë°± ìŠ¤íƒ€ì¼)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
        attribution: 'Â© OpenStreetMap, Â© CartoDB',
        maxZoom: 18,
        opacity: 0.9
    }).addTo(map);

    // GPSë¡œ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ (ì„ íƒ)
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            var marker = L.circleMarker([lat, lon], {
                radius: 8,
                fillColor: "#0ba29d",
                color: "#0ba29d",
                weight: 2,
                opacity: 0.8,
                fillOpacity: 0.8
            }).addTo(map);
            marker.bindPopup("ğŸ“ í˜„ì¬ ìœ„ì¹˜").openPopup();
        });
    }

    // ì§€ë„ ìƒ‰ì¹ í•˜ê¸°
    fetch('https://raw.githubusercontent.com/vuski/admdongkor/master/ver20250401/HangJeongDong_ver20250401.geojson')
        .then(res => res.json())
        .then(geoData => {
            L.geoJSON(geoData, {
                style: feature => {
                    // "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™" ì•ˆì— "ì—­ì‚¼ë™"ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ìƒ‰ì¹ 
                    if (feature.properties.adm_nm.includes("ê°•ë‚¨êµ¬")) {
                        return {
                            color: "#db250d",
                            weight: 2,
                            fillColor: "#0ba29d",
                            fillOpacity: 0.6
                        };
                    }
                    return {
                        color: "#ccc",
                        weight: 1,
                        fillColor: "#f5f5f5",
                        fillOpacity: 0.1
                    };
                },
                onEachFeature: (feature, layer) => {
                    layer.bindPopup(feature.properties.adm_nm);
                }
            }).addTo(map);
        })
        .catch(err => console.error("ğŸš¨ GeoJSON ë¡œë“œ ì‹¤íŒ¨:", err));
</script>
</body>
</html>